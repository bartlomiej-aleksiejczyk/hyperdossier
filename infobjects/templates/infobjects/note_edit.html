{% extends "base_layout.html" %}
{% block content %}
    <h1>
        {% if note %}
            Edit note
        {% else %}
            Create note
        {% endif %}
    </h1>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <fieldset>
            <legend>Note</legend>
            {{ form.non_field_errors }}
            <div>
                {{ form.title.label_tag }}
                {{ form.title }}
                {{ form.title.errors }}
            </div>
            <div>
                {{ form.type.label_tag }}
                {{ form.type }}
                {{ form.type.errors }}
            </div>
            <div>
                {{ form.category.label_tag }}
                {{ form.category }}
                {{ form.category.errors }}
            </div>
            <div>
                {{ form.content.label_tag }}
                {{ form.content }}
                {{ form.content.errors }}
            </div>
        </fieldset>
        <fieldset style="margin-top: 2rem;">
            <legend>Attachments</legend>
            {{ formset.management_form }}
            {% for f in formset %}
                <div style="border: 1px solid #ddd;
                            padding: 0.5rem;
                            margin-bottom: 0.5rem">
                    {{ f.non_field_errors }}
                    <div>
                        {{ f.file.label_tag }}
                        {{ f.file }}
                        {{ f.file.errors }}
                    </div>
                    <div>
                        {{ f.original_name.label_tag }}
                        {{ f.original_name }}
                        {{ f.original_name.errors }}
                    </div>
                    <div>
                        {{ f.mime_type.label_tag }}
                        {{ f.mime_type }}
                        {{ f.mime_type.errors }}
                    </div>
                    {% if f.instance.pk %}<div>{{ f.DELETE }} {{ f.DELETE.label_tag }}  {# can_delete=True #}</div>{% endif %}
                </div>
            {% endfor %}
            <p>
                <em>Use the empty row at the bottom to add a new attachment.</em>
            </p>
        </fieldset>
        <button type="submit">Save</button>
        {% if note %}
            <a href="{% url 'infobjects:note_detail' note.pk %}">Back to detail</a>
        {% endif %}
    </form>
{% endblock content %}
